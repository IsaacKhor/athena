{% extends "base.html" %}


{% block scripts %}
<script language="JavaScript">
function toggle_selected(source, name) {
  checkboxes = document.getElementsByName(name);
  for(var i=0, n=checkboxes.length;i<n;i++) {
    checkboxes[i].checked = source.checked;
  }
}
</script>
{% endblock %}

{% block title %}
  {{assgn.course.code}} {{assgn.code}} - {{assgn.title}}
{% endblock %}

{% block header %}
  {{assgn.course.code}} {{assgn.code}} - {{assgn.title}}
{% endblock %}

{% block breadcrumbs %}
<li><a href={% url 'grader:home' %}>Home</a></li>
<li class='active'>Assignment</li>
{% endblock %}

{% block content %}
  <h1>{{assgn.code}}: {{assgn.title}}</h1>
  <b>Due at: </b> {{assgn.due_date}} <br/>
  <h3>Description</h3>
  {{assgn.desc}}
  
  {% if files|length > 0 or instructor_view %}
  
  <div style='width:600px'>
  <h3>Assignment Files</h3>
  {% if files|length > 0 %}
  
  <table class='table table-striped'>
      <th>Filename</th><th>Date Created</th><th>Size (bytes)</th>{% if instructor_view %}<th>Delete</th>{% endif %}
  {% for filename, size, create_date in files %}
  <tr>
      <td><a href={% url 'grader:assgnfile_download' assgn.id filename%}>{{ filename }}</a></td>
      <td>{{ create_date }}</td>
      <td>{{ size }}</td>
      {% if instructor_view %}
      <td><a class='btn btn-default' href={% url 'grader:assgnfile_delete' assgn.id filename %}>
      <span class="glyphicon glyphicon-trash"></span>
  </a></td>
      {% endif %}
  </tr>
  {% endfor %}
  </table>
  {% endif %}
  
  {% if instructor_view %}
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
      {{ file_form }}
      <br/>
    <input type="submit" class="btn btn-info" value="Add" />
  </form>
  {% endif %}

  </div>
  {% endif %}

  {% if student_view %}
  
  <div style='width:600px'>
  <h3>Submit</h3>
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="table">
      {{ form.as_table }}
    </table>
    <input type="submit" class="btn btn-info" value="Submit" />
  </form>
  </div>
  
  {% if prev_submissions|length > 0 %}
  <div style='width:400px'>
  <h3>Previous Submissions</h3>
  <table class="table">
  <th>Submit Time</th><th>Status</th><th>Download</th>
  {% for s in prev_submissions %}
  <tr>
    <td><a href={% url 'grader:submissions' assgn.id user.id %}>{{s.sub_date}}</a></td>
    <td>{% if s.status == s.CH_GRADED %}Graded{% elif s.status == s.CH_SUBMITTED %}Submitted{% endif %}</td>
    <!--Download option-->
    <td><a class="btn btn-primary btn-sm" href={% url 'grader:submission_download' s.id %}>
      <span class="glyphicon glyphicon-arrow-down"></span>
    </a></td>
  </tr>
  {% endfor %}
  </table>
  </div>
  {% else %}
  <br/>
  You have not submitted anything for this assignment yet
  {% endif %}
  {% endif %}
  
  {% if ta_view or instructor_view %}
  <div style='width:600px'>
  <h2>Submissions</h2>
  
  <form method='POST'>
      {% csrf_token %}
      
      <!--
      <button type='submit' class='btn btn-primary' name='action' value="grade_many">
      <span class="glyphicon glyphicon-ok"></span> Grade Selected
      </button>
      -->
       
      <button type='submit' class='btn btn-primary' name='action' value="download_many">
      <span class="glyphicon glyphicon-arrow-down"></span> Download Selected
      </button>
      <br/>
      <br/>
      
      <table class="table table-striped">
          <th><input type='checkbox' onClick='toggle_selected(this, "submissions")'></th>
          <th>Student</th><th>Last Submission</th><th>Status</th><th>Details</th><th>Download</th>
          
          {% for recent in recent_subs %}
              <tr valign='center'>
                  <td><input type='checkbox' name='submissions' value='{{recent.id}}'></td>
                  <td>{{recent.student.first_name}} {{recent.student.last_name}}</td>
                  <td>{{recent.sub_date}}</td>
                  <td>{% if recent.status == recent.CH_GRADED %}Graded{%else%}Submitted{%endif%}</td>
                  
                  <!--Details option-->
                  <td><a class="btn btn-primary" href={% url 'grader:submissions' assgn.id recent.student.id %}>
                    <span class="glyphicon glyphicon-info-sign"></span>
                  </td>
                  
                  <!--Download option-->
                  <td><a class="btn btn-primary" href={% url 'grader:submission_download' recent.id %}>
                    <span class="glyphicon glyphicon-arrow-down"></span>
                  </a></td>
              </tr>
          {% endfor %}
      </table>
  </form>
  </div>
  {% endif %}

{% endblock %}
